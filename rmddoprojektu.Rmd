---
title: "Projekt analiza danych samochodÃ³w"
output: html_document
date: "2025-01-31"
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Dominik Åukasiuk, Igor Korusiewicz, Szymon Chodun, Nicholas Pachos

## 1 Data Cleansing & Data Wrangling

### 1.1 Wczytanie danych

Wczytujemy plik z surowymi danymi samochody_new.csv

### 1.2 UsuniÄ™cie brakujÄ…cych wartoÅ›ci

Badamy i usuwamy brakujÄ…ce wartoÅ›ci w danych, uÅ¼ywamy do tego pakietÃ³w (tidyverse) i (naniar).

```{r include =FALSE}
library(readr)
library(dplyr)
library(naniar)
library(naniar)
library(ggplot2)
library(dplyr)
```

```{r, message=FALSE, warning=FALSE}

# Wczytanie pliku CSV
samochody_new <- read_csv("samochody_new.csv")

# PodglÄ…d danych
head(samochody_new)
```

```{r}

#Brakujace obserwacje
n_miss(samochody_new) #liczba brakujacych danych
n_complete(samochody_new) #liczba kompletynch obserwacji
prop_miss(samochody_new) #proporcja
# Sprawdzanie brakujÄ…cych wartoÅ›ci
samochody_new %>% 
  miss_case_table()

# Wizualizacja brakÃ³w danych

#Wizualizacja brakujacych obserwacji
vis_miss(samochody_new, warn_large_data = FALSE)
#wizualizacja brakujacych danych
gg_miss_fct(samochody_new, fct = gearbox) 
#brakujace dane ze wzgledu na typ skrzyni biegow
gg_miss_upset(samochody_new, 
              nsets = 10)
```

### 1.3 Poprawa formatowania i eliminacja ocena brakujÄ…cych

Zamieniami dane w odpowiednich kolumnach (np. year z milage, do swojej kolumy)

```{r, include=FALSE}
library(readr)
library(naniar)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(dlookr)
library(editrules)
library(VIM)
library(deducorrect)
library(ISLR)
#Zastapienie innych wartosci specjalnych na NA
is.special <- function(x){
  if (is.numeric(x)) !is.finite(x) else is.na(x)
}

sapply(samochody_new, is.special)
#Dodanie warunkow do danych
unique(samochody_new$gearbox)
RULE <- editset(c("year >= 1900","gearbox %in% c('manual','automatic')"
                  , "price_in_pln > 0"))
violated <- violatedEdits(RULE, samochody_new)
```

```{r, message=FALSE, include=FALSE}
library(readr)
library(visdat)

# Funkcja do zamiany danych w kolumnach year i engine_capacity
fix_year_and_engine_capacity <- function(data) {
  invalid_year <- grepl("cm3$", data$year)
  data$engine_capacity[invalid_year] <- data$year[invalid_year]
  data$year[invalid_year] <- NA
  invalid_engine_capacity <- grepl("^[1-2][0-9]{3}$", data$engine_capacity) & 
      as.numeric(data$engine_capacity) > 1900
  data$year[invalid_engine_capacity] <- data$engine_capacity[invalid_engine_capacity]
  data$engine_capacity[invalid_engine_capacity] <- NA
  return(data)
}

# Zastosuj funkcjÄ™ do swojego zbioru danych
samochody_new <- fix_year_and_engine_capacity(samochody_new)

# Funkcja do zamiany danych w kolumnach year i fuel_type
fix_year_and_fuel_type <- function(data) {
  fuel_types <- c("Elektryczny", "Benzyna", "Diesel", "Hybryda", "Benzyna+LPG")
  invalid_year <- data$year %in% fuel_types
  data$fuel_type[invalid_year] <- data$year[invalid_year]
  data$year[invalid_year] <- NA
  invalid_fuel_type <- grepl("^[1-2][0-9]{3}$", data$fuel_type) & 
      as.numeric(data$fuel_type) > 1900
  data$year[invalid_fuel_type] <- data$fuel_type[invalid_fuel_type]
  data$fuel_type[invalid_fuel_type] <- NA
  return(data)
}

# Zastosuj funkcjÄ™ do swojego zbioru danych
samochody_new <- fix_year_and_fuel_type(samochody_new)

# Funkcja do zamiany danych w kolumnach fuel_type i mileage
fix_fuel_type_and_mileage <- function(data) {
  invalid_fuel_type <- grepl("km$", data$fuel_type)
  data$mileage[invalid_fuel_type] <- data$fuel_type[invalid_fuel_type]
  data$fuel_type[invalid_fuel_type] <- NA
  fuel_types <- c("Elektryczny", "Benzyna", "Diesel", "Hybryda", "Benzyna+LPG")
  invalid_mileage <- data$mileage %in% fuel_types
  data$fuel_type[invalid_mileage] <- data$mileage[invalid_mileage]
  data$mileage[invalid_mileage] <- NA
  return(data)
}

# Zastosuj funkcjÄ™ do swojego zbioru danych
samochody_new <- fix_fuel_type_and_mileage(samochody_new)

# Funkcja do zamiany danych w kolumnach year i mileage
fix_year_and_mileage <- function(data) {
  invalid_year <- grepl("km$", data$year)
  data$mileage[invalid_year] <- data$year[invalid_year]
  data$year[invalid_year] <- NA
  invalid_mileage <- grepl("^[1-2][0-9]{3}$", data$mileage) & 
      as.numeric(data$mileage) > 1900
  data$year[invalid_mileage] <- data$mileage[invalid_mileage]
  data$mileage[invalid_mileage] <- NA
  return(data)
}

# Zastosuj funkcjÄ™ do swojego zbioru danych
samochody_new <- fix_year_and_mileage(samochody_new)

# Wizualizacja brakujÄ…cych danych
vis_miss(samochody_new, warn_large_data = FALSE)
```

### 1.4 Imputowanie wartoÅ›ci dla brakujÄ…cych lub bÅ‚Ä™dnych danych

```{r, message=FALSE, include=FALSE}
#Biblioteki
library(readr)
library(naniar)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(dlookr)
library(editrules)
library(VIM)
library(deducorrect)
library(ISLR) 
library(hot.deck)
library(mice)
```

```{r include = FALSE}
#Imputacja brakÃ³w danych za pomocÄ… funkcji mice 
imputed_data <- mice(samochody_new, method = "pmm", m = 5, maxit = 10, seed = 123)

# Pobranie pierwszego uzupeÅ‚nionego zbioru danych
samochody_new_imputed <- complete(imputed_data, 1)

# Nadpisanie kolumny year w oryginalnym zbiorze
samochody_new$year <- samochody_new_imputed$year 

# Sprawdzenie czy braki zostaÅ‚y uzupeÅ‚nione
vis_miss(samochody_new, warn_large_data = FALSE)

# ZastÄ…pienie NA w kolumnie fuel_type
samochody_new$fuel_type <- ifelse(
  is.na(samochody_new$fuel_type) & samochody_new$engine_capacity == "Elektryczny",
  "Elektryczny",
  samochody_new$fuel_type
)
# efekty zastÄ…pienia NA w elektrycznych autach
vis_miss(samochody_new, warn_large_data = FALSE)
# eliminowanie NA w hybrydach
samochody_new$fuel_type <- ifelse(
  is.na(samochody_new$fuel_type) & samochody_new$engine_capacity == "Hybryda",
  "Hybryda",
  samochody_new$fuel_type
)
vis_miss(samochody_new, warn_large_data = FALSE)


samochody_new$engine_capacity <- trimws(tolower(samochody_new$engine_capacity))

# ZastÄ…pienie brakÃ³w w fuel_type
samochody_new$fuel_type <- ifelse(
  is.na(samochody_new$fuel_type) & samochody_new$engine_capacity == "elektryczny",
  "Elektryczne",
  samochody_new$fuel_type
)
table(is.na(samochody_new$fuel_type))
##
# WyodrÄ™bnienie kolumn fuel_type i brand
samochody_fuel_brand <- samochody_new[, c("fuel_type", "brand"), drop = FALSE]
```

```{r, include=FALSE}
# Imputacja tylko dla kolumn fuel_type i brand
imputed_data <- mice(samochody_fuel_brand, method = c("polyreg", "polyreg"), m = 5, maxit = 10, seed = 123)
```

```{r}
# Uzyskanie pierwszej imputacji
fuel_brand_imputed <- complete(imputed_data, 1)

# Zaktualizowanie oryginalnych kolumn fuel_type i brand w samochody_new
samochody_new$fuel_type <- fuel_brand_imputed$fuel_type
samochody_new$brand <- fuel_brand_imputed$brand

vis_miss(samochody_new, warn_large_data = FALSE)
```

### 1.5 Oczyszcenie danych z dalszych brakujÄ…cych wartoÅ›ci

```{r}
# UsuniÄ™cie wierszy z NA w kolumnie 'fuel_type'
samochody_new_cleaned <- samochody_new[!is.na(samochody_new$fuel_type), ]

# WyÅ›wietlenie oczyszczonej ramki danych
print(samochody_new_cleaned)
vis_miss(samochody_new_cleaned, warn_large_data = FALSE)

#decyzja o usuniÄ™ciu obserwacji z NA 
samochody_dowiz <- samochody_new[complete.cases(samochody_new), ]
```

Wynikiem jest poniÅ¼sza tabela z danymi po oczyszczeniu z brakujÄ…cych wartoÅ›ci:

```{r,echo=FALSE}
print(samochody_dowiz)
vis_miss(samochody_dowiz, warn_large_data = FALSE)
```

MoÅ¼emy zauwaÅ¼yc kompletnosc danych po oczyszczeniu z brakujÄ…cych wartoÅ›ci

## 2 Wizualizacja danych

**Wizualizacja danych** to kluczowy proces w analizie danych, ktÃ³ry pozwala na skuteczne przedstawienie informacji w formie graficznej.
DziÄ™ki odpowiednim wykresom i diagramom, moÅ¼emy w Å‚atwy sposÃ³b zobaczyÄ‡ wzorce, zaleÅ¼noÅ›ci i trendy, ktÃ³re mogÄ… byÄ‡ trudne do uchwycenia w surowych danych liczbowych.
Celem wizualizacji jest uczynienie danych bardziej przystÄ™pnymi i zrozumiaÅ‚ymi, zarÃ³wno dla specjalistÃ³w, jak i osÃ³b nieznajÄ…cych siÄ™ na analizie danych.

```{r,include=FALSE}
# przeksztaÅ‚cenie
dane <- samochody_dowiz %>%
  mutate(
    mileage = mileage %>%
      str_remove_all("[^0-9]") %>%  
      as.numeric(),                 
    engine_capacity = engine_capacity %>%
      str_remove_all("[^0-9]") %>%  
      as.numeric()                  
  )
# Liczenie liczby wystÄ…pieÅ„ kaÅ¼dej marki
top_5_brands <- dane %>%
  count(brand) %>%
  top_n(5, n) %>%
  pull(brand)
# Filtrujemy dane, aby uwzglÄ™dniÄ‡ tylko te 5 marek
samochody_top_5_brands <- dane %>%
  filter(brand %in% top_5_brands)
```

### 2.1. Wykresy zmiennej iloÅ›ciowej

**Wykres liniowy (line plot) - Trend cen samochodÃ³w w zaleÅ¼noÅ›ci od roku produkcji**

```{r,echo=FALSE,  warning=FALSE}
#Wykres liniowy (line plot) - Trend cen samochodÃ³w w zaleÅ¼noÅ›ci od roku produkcji
dane %>%
  group_by(year) %>%
  summarise(mean_price = mean(price_in_pln, na.rm = TRUE)) %>%
  ggplot(aes(x = year, y = mean_price)) +
  geom_line(color = "blue") +
  geom_point(color = "red") +
  theme_minimal() +
  labs(
    title = "Trend cen samochodÃ³w w zaleÅ¼noÅ›ci od roku produkcji",
    x = "Rok produkcji",
    y = "Åšrednia cena (PLN)"
  )
```

Åšrednia cena samochodÃ³w jest najwyÅ¼sza dla nowych modeli, ale ciekawe jest to, Å¼e samochody z 1999 roku bywajÄ… droÅ¼sze od tych z 1998 czy 1997 ğŸ¤”.

**Wykres Å›redniej ceny w zaleÅ¼noÅ›ci od rodzaju paliwa**

```{r,echo=FALSE}
# Wykres Å›redniej ceny w zaleÅ¼noÅ›ci od rodzaju paliwa
dane %>%
  group_by(fuel_type) %>%
  summarise(mean_price = mean(price_in_pln, na.rm = TRUE)) %>%
  ggplot(aes(x = fuel_type, y = mean_price, fill = fuel_type)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(
    title = "Åšrednia cena samochodÃ³w w zaleÅ¼noÅ›ci od rodzaju paliwa",
    x = "Rodzaj paliwa",
    y = "Åšrednia cena (PLN)"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_brewer(palette = "Set3")
```

NajdroÅ¼sze sÄ… samochody elektryczne, ktÃ³re zyskujÄ… na popularnoÅ›ci z powodu rosnÄ…cego zainteresowania ekologicznymi i nowoczesnymi technologiami.
Wysoka cena tych pojazdÃ³w wynika z kosztÃ³w baterii, zaawansowanej technologii oraz innowacyjnych rozwiÄ…zaÅ„, ktÃ³re zapewniajÄ… ich duÅ¼Ä… wydajnoÅ›Ä‡ i zasiÄ™g.
OprÃ³cz elektrycznych, drogie sÄ… takÅ¼e pojazdy hybrydowe, ktÃ³re Å‚Ä…czÄ… napÄ™d spalinowy z elektrycznym, oferujÄ…c wiÄ™kszÄ… oszczÄ™dnoÅ›Ä‡ paliwa i mniejsze emisje spalin ğŸŒ±ğŸš—.

### 2.2 Wykresy zmiennej jakoÅ›ciowej

**Wykres koÅ‚owy - Typ paliwa, liczba samochodÃ³w w zaleÅ¼noÅ›ci od roku produkcji**

```{r,echo=FALSE}
# Wykres koÅ‚owy- typ paliwa
fuel_count <- dane %>%
  count(fuel_type)

ggplot(fuel_count, aes(x = "", y = n, fill = fuel_type)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  labs(title = "Procentowy udziaÅ‚ rodzaju paliwa", x = NULL, y = NULL) +
  theme_minimal() +
  theme(axis.text.x = element_blank())
```

Wykres pokazuje procentowy udziaÅ‚ paliw w samochodach.
**Benzyna i Diesel dominujÄ…**, podczas gdy **paliwa alternatywne (LPG, CNG, elektryczne, hybrydy) majÄ… niewielki udziaÅ‚**.
ğŸš—ğŸ’¨

**Top 10 najczÄ™stszych marek samochodÃ³w**

```{r,echo=FALSE}
#Top 10 najczÄ™stszych marek samochodÃ³w
dane %>%
  count(brand) %>%
  arrange(desc(n)) %>%
  top_n(10, n) %>%
  ggplot(aes(x = reorder(brand, -n), y = n, fill = brand)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(
    title = "Top 10 najczÄ™stszych marek samochodÃ³w",
    x = "Marka",
    y = "Liczba wystÄ…pieÅ„"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_brewer(palette = "Set3")
```

Z analizowanego wykresu dotyczÄ…cego najczÄ™Å›ciej rejestrowanych marek samochodÃ³w w Polsce wynika, Å¼e **Volkswagen** zajmuje pierwsze miejsce, z liczbÄ… rejestracji przekraczajÄ…cÄ… 10 000 sztuk, co czyni go jedynÄ… markÄ… w tej czoÅ‚Ã³wce, ktÃ³rej wynik wyraÅºnie przekracza tÄ™ granicÄ™.
Obok Volkswagena, w zestawieniu znalazÅ‚y siÄ™ takie marki jak **Opel** i **BMW**, ktÃ³re rÃ³wnieÅ¼ cieszÄ… siÄ™ duÅ¼Ä… popularnoÅ›ciÄ… na polskim rynku motoryzacyjnym.

### 2.3 Wykresy dwÃ³ch zmiennych jakoÅ›ciowych

**Wykresy dwÃ³ch zmiennych jakoÅ›ciowych**

```{r,echo=FALSE}
# Wykres liczby samochodÃ³w(rodzaju paliwa) w zaleÅ¼noÅ›ci od wojewodztwa
dane %>%
  group_by(voivodeship) %>%
  filter(n() > 30) %>%
  ungroup() %>%
  ggplot(aes(x = voivodeship, fill = fuel_type)) +
  geom_bar(position = "stack") +
  theme_minimal() +
  labs(
    title = "Rodzaj paliwa w wojewÃ³dztwach z wiÄ™cej niÅ¼ 10 samochodami",
    x = "WojewÃ³dztwo",
    y = "Liczba samochodÃ³w",
    fill = "Rodzaj paliwa"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_brewer(palette = "Set3")
```

Wykres pokazuje liczbÄ™ samochodÃ³w wedÅ‚ug rodzaju paliwa w wojewÃ³dztwach.
**Benzyna i Diesel dominujÄ…**, szczegÃ³lnie w Mazowieckim, ÅšlÄ…skim i Wielkopolskim.
Paliwa alternatywne (LPG, CNG, hybrydy, elektryczne) stanowiÄ… niewielki udziaÅ‚.
ğŸš—ğŸ”‹

### 2.4 Wykresy dwÃ³ch zmiennych iloÅ›ciowych

**Wykres liczby samochodÃ³w (rodzaju paliwa) w zaleÅ¼noÅ›ci od wojewÃ³dztwa**

```{r,echo=FALSE}
# Wykres liczby samochodÃ³w w zaleÅ¼noÅ›ci od roku produkcji
dane %>%
  ggplot(aes(x = year)) +
  geom_bar(fill = "steelblue") +
  theme_minimal() +
  labs(
    title = "Liczba samochodÃ³w w zaleÅ¼noÅ›ci od roku produkcji",
    x = "Rok produkcji",
    y = "Liczba samochodÃ³w"
  )
```

Wykres pokazuje liczbÄ™ samochodÃ³w wedÅ‚ug roku produkcji.
**NajwiÄ™cej aut pochodzi z ostatnich kilkunastu lat**, a produkcja wzrosÅ‚a po 2000 r., osiÄ…gajÄ…c szczyt ok. 2018 r.
ğŸ“ˆğŸš—

**Wykres cena vs przebieg w zaleznosci od roku produkcji**

```{r,echo=FALSE}
# Wykres cena vs przebieg w zaleznosci od roku produkcji
dane <- dane %>%
  mutate(year_group = case_when(
    year >= 1995 & year <= 2000 ~ "1995-2000",
    year >= 2001 & year <= 2005 ~ "2001-2005",
    year >= 2006 & year <= 2010 ~ "2006-2010",
    year >= 2011 & year <= 2015 ~ "2011-2015",
    year >= 2016 & year <= 2020 ~ "2016-2020",
    year >= 2021 & year <= 2023 ~ "2021-2023",
    TRUE ~ "Other"
  ))

dane_avg <- dane %>%
  group_by(year_group) %>%
  summarise(
    avg_mileage = mean(mileage, na.rm = TRUE),
    avg_price_in_pln = mean(price_in_pln, na.rm = TRUE)
  )

ggplot(dane_avg, aes(x = avg_mileage, y = avg_price_in_pln, color = year_group)) +
  geom_point(alpha = 0.7, size = 3) +
  labs(title = "Cena vs. Przebieg w zaleÅ¼noÅ›ci od przedziaÅ‚u rocznego", x = "Åšredni przebieg (km)", y = "Åšrednia cena (PLN)") +
  theme_minimal() +
  scale_color_manual(values = rainbow(length(unique(dane_avg$year_group)))) +
  theme(legend.title = element_blank())
```

Cena samochodu w zaleÅ¼noÅ›ci od przebiegu i rocznika pokazuje wyraÅºnÄ… zaleÅ¼noÅ›Ä‡ miÄ™dzy wiekiem pojazdu a jego wartoÅ›ciÄ… rynkowÄ….
Zwykle najdroÅ¼sze sÄ… samochody nowe lub z niewielkim przebiegiem, poniewaÅ¼ sÄ… wciÄ…Å¼ objÄ™te gwarancjÄ…, oferujÄ… nowoczesne technologie, majÄ… mniejsze zuÅ¼ycie czÄ™Å›ci i sÄ… bardziej efektywne pod wzglÄ™dem paliwowym.
Takie auta zazwyczaj utrzymujÄ… swojÄ… wartoÅ›Ä‡ na rynku przez dÅ‚uÅ¼szy czas.

## 3 Analiza opisowa 

W tej sekcji przeanalizujemy podstawowe miary statystyczne, takie jak Å›rednia, mediana, minimalne i maksymalne wartoÅ›ci oraz odchylenie standardowe dla kluczowych zmiennych, takich jak przebieg, czy pojemnoÅ›Ä‡ silnika, a bliÅ¼ej zbadamy wÅ‚aÅ›ciowoÅ›ci na przykÅ‚ad skoÅ›noÅ›Ä‡ i kurtoza dla cen samochodÃ³w w zaleÅ¼noÅ›ci od marki.
Ponadto, zbadamy istniejÄ…ce korelacje miÄ™dzy zmiennymi numerycznymi i sprawdzimy jakie majÄ… wpÅ‚yw na cenÄ™ samochodu.

```{r, include=FALSE}
# Ustawienie serwera CRAN bez interakcji
options(repos = c(CRAN = "https://cran.rstudio.com"))

# Instalacja pakietu
install.packages("summarytools")
library(summarytools)

# Podsumowanie danych
summary_stats <- dfSummary(dane)

#Renderujemy tabelÄ™ bezpoÅ›rednio w HTML
summary_stats_html <- print(summary_stats, method = "render")

#WyÅ›wietlamy tabelÄ™ w dokumencie HTML
summary_stats_html
```

Åšrednia cena samochodÃ³w w caÅ‚ym zbiorze wynosi **76 580,2 PLN**, przy odchyleniu standardowym rÃ³wnym **100 937 PLN**, co wskazuje na znacznÄ… zmiennoÅ›Ä‡ cen w analizowanym zestawie danych.
Minimalna cena samochodu to **1 111 PLN**, mediana wynosi **46 900 PLN**, a maksymalna cena osiÄ…ga aÅ¼ **2 550 000 PLN**, co Å›wiadczy o duÅ¼ej rozpiÄ™toÅ›ci cen w zbiorze.

RozstÄ™p miÄ™dzykwartylowy (IQR), czyli rÃ³Å¼nica miÄ™dzy trzecim a pierwszym kwartylem, wynosi **66 099 PLN**, co pokazuje zakres, w ktÃ³rym znajduje siÄ™ Å›rodkowe 50% cen samochodÃ³w.
WspÃ³Å‚czynnik zmiennoÅ›ci (CV), obliczony jako stosunek odchylenia standardowego do Å›redniej, wynosi **1,3** (130%), co dodatkowo podkreÅ›la znacznÄ… rozbieÅ¼noÅ›Ä‡ cen w analizie.

```{r, include=FALSE}
install.packages("GGally")
install.packages("summarytools")
install.packages("dplyr")
install.packages("psych")
install.packages("summarytools")
install.packages("flextable")
install.packages("writexl")
install.packages("kableExtra")
library(writexl)
library(flextable)
library(summarytools)
library(ggplot2)
library(GGally)
library(dplyr)
library(psych)
library(summarytools)
library(kableExtra)

ggcorr(
  data = dane %>% select(where(is.numeric)),
  method = c("pairwise.complete.obs" , "pearson"),
  label = TRUE
) +
  theme(
    axis.text.x = element_text(hjust = 1), 
    axis.text.y = element_text(hjust = 1)
  )
```

1.  **Rok produkcji** ma silny zwiÄ…zek z **przebiegiem** (korelacja -0,7) â€“ nowsze samochody majÄ… zazwyczaj niÅ¼szy przebieg.

2.  **Cena samochodu** jest najbardziej zaleÅ¼na od **roku produkcji** (korelacja 0,5) â€“ nowsze modele sÄ… droÅ¼sze.

3.  **Przebieg** rÃ³wnieÅ¼ wpÅ‚ywa na cenÄ™ (korelacja -0,4) â€“ samochody z niÅ¼szym przebiegiem sÄ… droÅ¼sze.

4.  PozostaÅ‚e zaleÅ¼noÅ›ci, np.
    miÄ™dzy pojemnoÅ›ciÄ… silnika a cenÄ… lub przebiegiem, sÄ… sÅ‚abe i nie majÄ… znaczÄ…cego wpÅ‚ywu.

PodsumowujÄ…c, **rok produkcji** i **przebieg** to kluczowe czynniki wpÅ‚ywajÄ…ce na cenÄ™ samochodu w tym zbiorze danych.

```{r, echo=FALSE}
# Grupowanie danych po 'brand' i obliczanie statystyk dla kaÅ¼dej grupy
library(dplyr)

analiza_df <- dane %>%
  group_by(brand) %>%
  summarise(
    Min = min(price_in_pln, na.rm = TRUE),
    Max = max(price_in_pln, na.rm = TRUE),
    `Kwartyl dolny` = quantile(price_in_pln, 0.25, na.rm = TRUE),
    Mediana = round(median(price_in_pln, na.rm = TRUE), 2),
    `Kwartyl gÃ³rny` = quantile(price_in_pln, 0.75, na.rm = TRUE),
    Åšrednia = round(mean(price_in_pln, na.rm = TRUE), 2),
    `Odch. std.` = round(sd(price_in_pln, na.rm = TRUE), 2),
    IQR = round(IQR(price_in_pln, na.rm = TRUE), 2),
    `Odchylenie Ä‡wiartkowe` = round(IQR(price_in_pln, na.rm = TRUE) / 2, 2),
    `SkoÅ›noÅ›Ä‡` = round(skew(price_in_pln, na.rm = TRUE), 2),
    `Kurtoza` = round(kurtosi(price_in_pln, na.rm = TRUE), 2),
    .groups = "drop"
  )

ogolne_podsumowanie <- dane %>%
  summarise(
    brand = "OgÃ³lnie",
    Min = min(price_in_pln, na.rm = TRUE),
    Max = max(price_in_pln, na.rm = TRUE),
    `Kwartyl dolny` = quantile(price_in_pln, 0.25, na.rm = TRUE),
    Mediana = round(median(price_in_pln, na.rm = TRUE), 2),
    `Kwartyl gÃ³rny` = quantile(price_in_pln, 0.75, na.rm = TRUE),
    Åšrednia = round(mean(price_in_pln, na.rm = TRUE), 2),
    `Odch. std.` = round(sd(price_in_pln, na.rm = TRUE), 2),
    IQR = round(IQR(price_in_pln, na.rm = TRUE), 2),
    `Odchylenie Ä‡wiartkowe` = round(IQR(price_in_pln, na.rm = TRUE) / 2, 2),
    `SkoÅ›noÅ›Ä‡` = round(skew(price_in_pln, na.rm = TRUE), 2),
    `Kurtoza` = round(kurtosi(price_in_pln, na.rm = TRUE), 2)
  )

pelna_tabela <- bind_rows(ogolne_podsumowanie, analiza_df)

kable(pelna_tabela, 
      col.names = c("Marka", "Min", "Max", "Kwartyl dolny", "Mediana", 
                    "Kwartyl gÃ³rny", "Åšrednia", "Odch. std.", "IQR", 
                    "Odchylenie Ä‡wiartkowe", "SkoÅ›noÅ›Ä‡", "Kurtoza"),
      caption = "Podsumowanie cen samochodÃ³w wedÅ‚ug marki (w tym ogÃ³lnie)")


```

Statystyki zbiorcze dla wszystkich marek samochodÃ³w ksztaÅ‚tujÄ… siÄ™ nastÄ™pujÄ…co: Å›rednia cena samochodÃ³w wynosi **76 580,17 PLN**, ale rozkÅ‚ad cen jest bardzo szeroki, co wskazuje na duÅ¼Ä… rÃ³Å¼norodnoÅ›Ä‡ oferty.
Ceny wahajÄ… siÄ™ od **1 111 PLN** do **2 550 000 PLN**, co pokazuje, Å¼e w zbiorze znajdujÄ… siÄ™ zarÃ³wno bardzo tanie, jak i luksusowe modele.
Mediana wynosi **46 900 PLN**, co sugeruje, Å¼e poÅ‚owa samochodÃ³w jest taÅ„sza niÅ¼ ta kwota.
DuÅ¼e odchylenie standardowe (**100 936,95 PLN**) oraz wysoka skoÅ›noÅ›Ä‡ (**5,2**) i kurtoza (**52,04**) wskazujÄ… na silnÄ… prawostronnÄ… skoÅ›noÅ›Ä‡ rozkÅ‚adu â€“ wiÄ™kszoÅ›Ä‡ samochodÃ³w ma stosunkowo niskie ceny, ale istnieje spora liczba bardzo drogich modeli, ktÃ³re podnoszÄ… Å›redniÄ….

**Lamborghini** to marka z najwyÅ¼szymi cenami.
Åšrednia cena wynosi **1 271 214,29 PLN**, a zakres cen to **289 000â€“2 550 000 PLN**.
To jedyna marka, ktÃ³rej ceny przekraczajÄ… 2 miliony PLN.

**Smart** ma najniÅ¼szÄ… medianÄ™ cen (**8 100 PLN**) i jednoczeÅ›nie najwyÅ¼szÄ… skoÅ›noÅ›Ä‡ (**3,56**) oraz kurtozÄ™ (**18,32**), co wskazuje na silne skupienie siÄ™ na niskich cenach z nielicznymi wyjÄ…tkami.

**Mercedes-Benz** marka o szerokim zakresie cen (**1 500â€“2 298 999 PLN**) i wysokim odchyleniu standardowym (**174 014,86 PLN**), co pokazuje, Å¼e oferuje zarÃ³wno modele budÅ¼etowe, jak i luksusowe.

**Luksusowe marki** (Lamborghini, Ferrari, Bentley) majÄ… bardzo wysokie ceny, czÄ™sto przekraczajÄ…ce milion PLN, co wpÅ‚ywa na ogÃ³lne statystyki, podnoszÄ…c Å›redniÄ… i odchylenie standardowe.

**Marki budÅ¼etowe** (Daewoo, Dacia, Smart) oferujÄ… samochody w niskich cenach, ale ich udziaÅ‚ w ogÃ³lnej ofercie jest niewielki.

**Marki popularne** (Toyota, Volkswagen, Ford) majÄ… umiarkowane ceny i stosunkowo stabilny rozkÅ‚ad, co czyni je atrakcyjnymi dla wiÄ™kszoÅ›ci klientÃ³w.

## 4 Wnioskowanie statystyczne 

```{r, include=FALSE}
library(ggstatsplot)
library(ggplot2)
```

W tym rozdziale przeprowadzona zostaÅ‚a analiza statystyczna, majÄ…ca na celu identyfikacjÄ™ zaleÅ¼noÅ›ci miÄ™dzy rÃ³Å¼nymi cechami samochodÃ³w a ich cenÄ….
Wykorzystano do tego rÃ³Å¼ne testy statystyczne i metody wizualizacji danych z pakietu ggstatsplot.

**1.Histogram cen samochodÃ³w i test normalnoÅ›ci**

ğŸ“ŒRozkÅ‚ad cen samochodÃ³w nie jest normalny â€“ jest prawostronnie asymetryczny (duÅ¼a liczba taÅ„szych aut, kilka bardzo drogich).
ğŸ“Œ Nie moÅ¼na stosowaÄ‡ testÃ³w parametrycznych opartych na rozkÅ‚adzie normalnym.
ğŸ“Œ PrzedziaÅ‚ ufnoÅ›ci dla Å›redniej ceny samochodu wynosi od 75 931 PLN do 77 270 PLN (95% pewnoÅ›ci).

ğŸ“Š Wizualizacja: Histogram cen samochodÃ³w, pokazujÄ…cy asymetriÄ™ w rozkÅ‚adzie.

```{r echo = FALSE, warning=FALSE}
gghistostats(
  data = dane,
  x = price_in_pln,
  title = "Histogram cen samochodÃ³w z testem normalnoÅ›ci",
  xlab = "Cena (PLN)",
  test.value = 0,
  type = "parametric"
) +
  scale_x_continuous(
    limits = c(0, 1000000),
    breaks = seq(0, 1000000, by = 200000),  # Etykiety co 200k
    labels = scales::comma
  )

```

**2.PorÃ³wnanie cen samochodÃ³w w zaleÅ¼noÅ›ci od rodzaju paliwa.**

Za pomocÄ… testu F Welcha sprawdzono, czy rÃ³Å¼nice w Å›rednich cenach miÄ™dzy samochodami elektrycznymi, benzynowymi, hybrydowymi i dieslami sÄ… statystycznie istotne.

Wyniki wskazujÄ…, Å¼e: âœ… IstniejÄ… istotne rÃ³Å¼nice cenowe miÄ™dzy rodzajami paliwa (p \< 0.001).
âœ… Samochody elektryczne majÄ… wyraÅºnie wyÅ¼sze ceny w porÃ³wnaniu do innych typÃ³w paliwa.
âœ… WspÃ³Å‚czynnik efektu (0.96) sugeruje, Å¼e rodzaj paliwa silnie wpÅ‚ywa na cenÄ™.
âœ… Bardzo duÅ¼a liczba obserwacji (n = 83,625) sprawia, Å¼e test jest bardzo wiarygodny

ğŸ“Š Wizualizacja: Wykres pudeÅ‚kowy przedstawiajÄ…cy Å›rednie ceny w zaleÅ¼noÅ›ci od rodzaju paliwa.

```{r, echo=FALSE}
ggbetweenstats(
  data = dane,
  x = fuel_type,
  y = price_in_pln,
  type = "parametric", 
  title = "PorÃ³wnanie Å›rednich cen samochodÃ³w w zaleÅ¼noÅ›ci od rodzaju paliwa",
  xlab = "Rodzaj paliwa",
  ylab = "Cena (PLN)",
  messages = FALSE
)
```

**3.Korelacja miÄ™dzy przebiegiem a cenÄ… samochodu.**

Badanie zwiÄ…zku miÄ™dzy liczbÄ… przejechanych kilometrÃ³w a cenÄ… samochodu wykazaÅ‚o:

```{r, echo=FALSE, include = FALSE}
cor.test(dane$mileage, dane$price_in_pln, method = "spearman")
```

-WartoÅ›Ä‡ wspÃ³Å‚czynnika korelacji Spearmana wynosi -0.59.
To oznacza umiarkowanÄ… negatywnÄ… korelacjÄ™ miÄ™dzy przebiegiem a cenÄ… samochodu.
Im wiÄ™kszy przebieg, tym niÅ¼sza cena samochodu.
-Jest to zgodne z intuicjÄ…, poniewaÅ¼ samochody z wiÄ™kszym przebiegiem sÄ… zazwyczaj starsze i mogÄ… byÄ‡ bardziej zuÅ¼yte.

-IstotnoÅ›Ä‡ statystyczna: Korelacja jest statystycznie istotna, wiÄ™c moÅ¼emy z duÅ¼Ä… pewnoÅ›ciÄ… stwierdziÄ‡, Å¼e ta zaleÅ¼noÅ›Ä‡ jest prawdziwa w populacji samochodÃ³w.

```{r, echo=FALSE}
kruskal.test(price_in_pln ~ mileage, data = dane)
```

Wynik dla statystyka testu Kruskala-Wallisa 47625.
Jest to miara rÃ³Å¼nic miÄ™dzy grupami.
WartoÅ›Ä‡ 47625 wskazuje, Å¼e rÃ³Å¼nice miÄ™dzy grupami (w tym przypadku cenami samochodÃ³w w zaleÅ¼noÅ›ci od przebiegu) sÄ… doÅ›Ä‡ duÅ¼e.

Interpretacja: Hipoteza zerowa (Hâ‚€): ZakÅ‚ada, Å¼e nie ma rÃ³Å¼nic miÄ™dzy grupami (w tym przypadku brak rÃ³Å¼nic w cenach samochodÃ³w w zaleÅ¼noÅ›ci od przebiegu).
Hipoteza alternatywna (Hâ‚): ZakÅ‚ada, Å¼e istniejÄ… rÃ³Å¼nice miÄ™dzy grupami (w tym przypadku ceny samochodÃ³w rÃ³Å¼niÄ… siÄ™ w zaleÅ¼noÅ›ci od przebiegu).
PoniewaÅ¼ p-wartoÅ›Ä‡ jest mniejsza niÅ¼ 0.05 (a konkretnie jest znacznie mniejsza), oznacza to, Å¼e odrzucamy hipotezÄ™ zerowÄ….
W zwiÄ…zku z tym moÅ¼emy stwierdziÄ‡, Å¼e istniejÄ… statystycznie istotne rÃ³Å¼nice w cenach samochodÃ³w w zaleÅ¼noÅ›ci od przebiegu.

Wnioski: Test Kruskala-Wallisa wykazuje, Å¼e ceny samochodÃ³w rÃ³Å¼niÄ… siÄ™ w zaleÅ¼noÅ›ci od ich przebiegu.
Oznacza to,Å¼e w populacji samochodÃ³w przebieg moÅ¼e mieÄ‡ znaczenie dla ksztaÅ‚towania ceny samochodu.
Warto takÅ¼e zauwaÅ¼yÄ‡, Å¼e test Kruskala-Wallisa jest testem nieparametrycznym, co oznacza, Å¼e nie zakÅ‚ada on rozkÅ‚adu normalnego danych.
Jest to dobry wybÃ³r, gdy dane majÄ… rozkÅ‚ad nienormalny lub zawierajÄ… wartoÅ›ci odstajÄ…ce.

ğŸ“Š Wizualizacja: Wykres rozrzutu pokazujÄ…cy negatywnÄ… zaleÅ¼noÅ›Ä‡ miÄ™dzy przebiegiem a cenÄ….

```{r}
plot(dane$mileage, dane$price_in_pln,
     xlab = "Przebieg (km)",
     ylab = "Cena (PLN)",
     main = "ZaleÅ¼noÅ›Ä‡ miÄ™dzy cenÄ… a przebiegiem samochodu")
```

**4.[WpÅ‚yw marki na cenÄ™ samochodu.]{.underline}**

PorÃ³wnano ceny samochodÃ³w piÄ™ciu najpopularniejszych marek, stosujÄ…c test Kruskala-Wallisa.
ğŸ”¹ BMW i Mercedes-Benz sÄ… najdroÅ¼szymi markami.
ğŸ”¹ Opel, Peugeot i Volkswagen majÄ… znaczÄ…co niÅ¼sze ceny.
ğŸ”¹ Test wykazaÅ‚ istotne rÃ³Å¼nice miÄ™dzy markami (p \< 0.001).
ğŸ”¹ Wykres wyraÅºnie pokazuje, Å¼e Å›rednie ceny samochodÃ³w rÃ³Å¼niÄ… siÄ™ w zaleÅ¼noÅ›ci od marki ğŸ“Š Wizualizacja: Wykres przedstawiajÄ…cy medianowe ceny samochodÃ³w rÃ³Å¼nych marek.

```{r echo= FALSE, warning=FALSE}
# UsuniÄ™cie brakujÄ…cych danych
samochody_top_5_brands <- na.omit(samochody_top_5_brands)

ggbetweenstats(
  data = samochody_top_5_brands,
  x = brand,
  y = price_in_pln,
  title = "ZaleÅ¼noÅ›Ä‡ ceny od marki samochodu",
  xlab = "Marka",
  ylab = "Cena (PLN)",
  type = "np",
  pairwise.comparisons = TRUE,
  pairwise.display = "significant",
  centrality.param = "median",
  centrality.para.method = "nonparametric",
  ggtheme = theme_bw(),
  outlier.tagging = FALSE,  # UsuniÄ™cie oznaczania wartoÅ›ci odstajÄ…cych
  messages = FALSE
) +
  scale_y_log10(limits = c(1000, 1e6)) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.text = element_text(size = 12),
    plot.title = element_text(size = 16),
    legend.position = "bottom"
  )
```

**5.WpÅ‚yw roku produkcji na cenÄ™**

ğŸ“ŒKorelacja Spearmana wynosi 0.77, co potwierdza istotnoÅ›Ä‡ statystycznÄ… tej zaleÅ¼noÅ›ci ğŸ“Œ Wykres pokazuje silnÄ… dodatniÄ… korelacjÄ™ miÄ™dzy rokiem produkcji a cenÄ… samochodu, co oznacza, Å¼e nowsze samochody sÄ… zazwyczaj droÅ¼sze.
ğŸ“ŒZauwaÅ¼alna jest pewna rozbieÅ¼noÅ›Ä‡ punktÃ³w, co sugeruje, Å¼e na cenÄ™ wpÅ‚ywajÄ… takÅ¼e inne czynniki, takie jak marka czy stan techniczny.
ğŸ“Œ Histogramy wskazujÄ…, Å¼e wiÄ™kszoÅ›Ä‡ samochodÃ³w pochodzi z lat 2010-2020, a ceny wiÄ™kszoÅ›ci pojazdÃ³w sÄ… poniÅ¼ej 1 miliona PLN.

ğŸ“Š Wizualizacja: Wykres rozrzutu pokazujÄ…cy wzrost cen wraz z nowszym rokiem produkcji.

```{r message=FALSE, warning=FALSE, echo = FALSE}
dane$year <- as.numeric(dane$year) 
dane$price_in_pln <- as.numeric(dane$price_in_pln)

# Teraz uruchom ggscatterstats
library(ggstatsplot)

ggscatterstats(
  data = dane,
  x = year,
  y = price_in_pln,
  title = "ZaleÅ¼noÅ›Ä‡ ceny od roku produkcji samochodu",
  xlab = "Rok produkcji",
  ylab = "Cena (PLN)",
  type = "np",  # Zastosowanie testu Kruskala-Wallisa (non-parametric)
  marginal = TRUE,  # Dodaje histogramy po bokach
  bf.message = FALSE  # Ukrywa Bayes Factor
)
```

### 5. Podsumowanie

ğŸ“Œ **Trendy cenowe i wpÅ‚yw roku produkcji:**

-   Analiza cen samochodÃ³w w zaleÅ¼noÅ›ci od roku produkcji ujawnia wyraÅºny trend wzrostu cen wÅ›rÃ³d nowszych modeli.
    NajdroÅ¼sze samochody to te produkowane w ostatnich latach, co jest naturalne ze wzglÄ™du na technologiÄ™, nowoczesnoÅ›Ä‡ oraz gwarancje zwiÄ…zane z nowymi pojazdami.

-   InteresujÄ…cym zjawiskiem jest jednak wyÅ¼sza cena samochodÃ³w z 1999 roku w porÃ³wnaniu do niektÃ³rych modeli z lat 1997 czy 1998, co moÅ¼e wynikaÄ‡ z unikalnych cech, poszukiwanych modeli lub niskiej dostÄ™pnoÅ›ci tych aut na rynku wtÃ³rnym.

ğŸ“Œ **Rodzaj paliwa a cena samochodÃ³w -** samochody elektryczne oraz hybrydowe sÄ… najdroÅ¼sze spoÅ›rÃ³d analizowanych typÃ³w paliwa, co wynika z kosztÃ³w zaawansowanej technologii (np. kosztÃ³w baterii w przypadku samochodÃ³w elektrycznych) oraz rosnÄ…cego zainteresowania ekologicznymi rozwiÄ…zaniami.

ğŸ“Œ **PodziaÅ‚ rynku wedÅ‚ug marek:**

-   Z analizy wynika, Å¼e najbardziej popularne marki to Volkswagen, Opel, i BMW, z czego Volkswagen jest zdecydowanym liderem na rynku samochodÃ³w uÅ¼ywanych w Polsce, przekraczajÄ…c liczbÄ™ 10 000 rejestracji.

-   Warto zauwaÅ¼yÄ‡ duÅ¼e zrÃ³Å¼nicowanie cenowe pomiÄ™dzy markami premium (np. Lamborghini, Ferrari) a budÅ¼etowymi (np. Smart, Dacia).
    Wysokie ceny luksusowych marek znaczÄ…co podnoszÄ… Å›redniÄ… cenÄ™ caÅ‚ego zbioru, a pojazdy budÅ¼etowe dominujÄ… w sprzedaÅ¼y pod wzglÄ™dem liczby rejestracji.
